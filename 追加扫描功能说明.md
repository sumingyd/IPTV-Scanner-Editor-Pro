# 追加扫描功能说明

## 功能概述
在IPTV-Scanner-Editor-Pro程序中添加了"追加扫描"功能，该功能与现有的"完整扫描"功能类似，但有一个关键区别：**不清空列表已有的数据**，扫描到的有效频道直接在列表里继续往下追加。

## 功能特点

### 1. 新增UI元素
- **追加扫描按钮**：位于"完整扫描"和"直接生成列表"按钮之间
- **按钮文本**：显示为"追加扫描"
- **工具提示**：鼠标悬停时显示"不清空现有列表，扫描到的有效频道直接追加到列表末尾"

### 2. 功能区别

| 功能 | 完整扫描 | 追加扫描 |
|------|----------|----------|
| **清空列表** | ✅ 是 | ❌ 否 |
| **保留现有频道** | ❌ 否 | ✅ 是 |
| **扫描结果位置** | 从列表开始 | 追加到列表末尾 |
| **按钮位置** | 左侧 | 中间 |
| **默认行为** | 原有功能 | 新增功能 |

### 3. 使用场景

1. **增量扫描**：当您已经有一些有效频道，想在不丢失现有频道的情况下继续扫描新的地址范围
2. **多源合并**：从不同的源地址扫描频道，合并到一个列表中
3. **分阶段扫描**：先扫描一部分地址，验证结果，然后继续扫描其他地址
4. **补充扫描**：发现某些频道缺失，补充扫描特定地址段

## 技术实现

### 1. UI修改
- **文件**: `ui_builder.py`
- **修改内容**: 在扫描控制按钮区域添加了"追加扫描"按钮
- **布局调整**: 三个按钮水平排列，自适应宽度

### 2. 逻辑修改
- **文件**: `main.py`
- **新增方法**:
  - `_on_append_scan_clicked()`: 处理追加扫描按钮点击事件
  - `_set_append_scan_button_text()`: 设置追加扫描按钮文本（支持多语言）
- **修改方法**:
  - `_start_scan_delayed()`: 添加`clear_list`参数，控制是否清空列表
  - `_on_scan_completed()`: 同时重置两个扫描按钮的文本
  - `_connect_signals()`: 连接追加扫描按钮的信号

### 3. 参数传递
- **完整扫描**: `_start_scan_delayed(url, clear_list=True)`
- **追加扫描**: `_start_scan_delayed(url, clear_list=False)`

## 使用流程

### 1. 基本使用
```
1. 在"输入地址"框中输入扫描地址
2. 点击"追加扫描"按钮
3. 程序开始扫描，有效频道追加到现有列表末尾
4. 扫描完成后，按钮恢复为"追加扫描"
```

### 2. 组合使用
```
场景：先扫描基础频道，再追加扫描高清频道

步骤：
1. 输入基础频道地址，点击"完整扫描"
2. 获得基础频道列表
3. 输入高清频道地址，点击"追加扫描"
4. 高清频道追加到列表末尾
5. 最终列表包含所有频道
```

### 3. 与现有功能配合
- **有效性检测**：可以对追加扫描的频道进行有效性检测
- **智能排序**：扫描完成后可以使用智能排序重新组织列表
- **隐藏无效项**：可以隐藏追加扫描中的无效频道
- **保存列表**：可以保存包含所有频道的完整列表

## 资源清理

### 1. 资源清理机制
- 追加扫描使用与完整扫描相同的资源清理机制
- 程序退出时会自动清理所有资源
- 支持优雅终止和强制终止

### 2. 清理处理器
追加扫描功能已集成到全局资源清理器中，包括：
- 定时器清理
- 扫描器线程清理
- 播放器资源释放
- 验证器进程清理
- 内存优化

## 测试建议

### 1. 功能测试
```python
# 测试步骤
1. 启动程序
2. 添加一些测试频道
3. 使用追加扫描功能
4. 验证现有频道是否保留
5. 验证新频道是否追加
```

### 2. 边界测试
- 空列表时使用追加扫描
- 满列表时使用追加扫描
- 扫描过程中停止追加扫描
- 多次连续追加扫描

### 3. 性能测试
- 大数据量下的追加扫描性能
- 内存使用情况
- 线程管理效率

## 注意事项

### 1. 数据一致性
- 追加扫描不会影响现有频道的顺序
- 新频道始终添加到列表末尾
- 频道ID和索引保持不变

### 2. 资源管理
- 追加扫描使用独立的扫描器实例
- 资源清理确保无内存泄漏
- 线程管理避免资源竞争

### 3. 用户体验
- 按钮状态清晰显示
- 进度条正常显示
- 错误处理完善

## 总结

追加扫描功能为用户提供了更灵活的扫描方式，特别适合以下场景：
- **频道收集**：从多个来源收集频道
- **增量更新**：定期更新频道列表
- **实验性扫描**：测试不同地址段的效果

该功能保持了与现有功能的兼容性，同时提供了新的使用模式，增强了程序的实用性和灵活性。
